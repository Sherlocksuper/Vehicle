import {Socket} from "net";

const client = new Socket()

const targetHost = '192.168.1.66'
const targetPort = 66

client.connect(targetPort, targetHost, () => {
  console.log('Connected to server')

  //使能：ff 00 02 02 0E
  // 挂起：ff 00 02 02 0D
  // 逆初始化 ： ff 00 02 02 DD
  // 配置波特率（500K为例）： ff 00 02 02 C1 00 00 01 F4
  // 配置解析配置（FrameID = 9为例）：ff 00 02 02 C2 00 00 00 00 09 01 00 20 05 05
  // 配置解析配置（FrameID = A为例）：ff 00 02 02 C2 01 00 00 00 0A 01 00 20 05 05
  // 配置解析配置(FrameID = C为例)  ：ff 00 02 02 C2 02 00 00 00 0C 04 00 20 01 01 08 20 01 01 16 04 01 01 17 04 01 01

  client.write(Buffer.from([0xff, 0x00, 0x02, 0x02, 0x0d]))
  setTimeout(()=>{
    client.write(Buffer.from([0xff, 0x00, 0x02, 0x02, 0xc1, 0x00, 0x00, 0x01, 0xf4]))
    setTimeout(() => {
      client.write(Buffer.from([0xff, 0x00, 0x02, 0x02, 0xc2, 0x00, 0x00, 0x00, 0x00, 0x09, 0x01, 0x00, 0x20, 0x05, 0x05]))
      setTimeout(() => {
        client.write(Buffer.from([0xff, 0x00, 0x02, 0x02, 0xc2, 0x01, 0x00, 0x00, 0x00, 0x0a, 0x01, 0x00, 0x20, 0x05, 0x05]))
        setTimeout(() => {
          client.write(Buffer.from([0xff, 0x00, 0x02, 0x02, 0xc2, 0x02, 0x00, 0x00, 0x00, 0x0c, 0x04, 0x00, 0x20, 0x01, 0x01, 0x08, 0x20, 0x01, 0x01, 0x16, 0x04, 0x01, 0x01, 0x17, 0x04, 0x01, 0x01]))
          setTimeout(() => {
            client.write(Buffer.from([0xff, 0x00, 0x02, 0x02, 0x0e]))
          }, 200);
        }, 200);
      }, 200);
    }, 200);
  },200)
})

client.on('data', data => {
  console.log('Received from server:', String(data))
})

client.on('error',(err, address, family, host)=>{
  console.log(err)
  console.log(address)
  console.log(family)
  console.log(host)
})

client.write(Buffer.from([0xff, 0x00, 0x02, 0x02, 0xc2, 0x02, 0x00, 0x00, 0x00, 0x0c, 0x04, 0x00, 0x20, 0x01, 0x01, 0x08, 0x20, 0x01, 0x01, 0x16, 0x04, 0x01, 0x01, 0x17, 0x04, 0x01, 0x01]))
